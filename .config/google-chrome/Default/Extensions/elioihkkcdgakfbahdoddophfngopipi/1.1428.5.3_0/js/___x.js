// "Photo Zoom for Facebook" v1.1408.5.2
// Everything is (c) Copyright by Regis Gaughan, III <regis.gaughan@gmail.com>.
// All rights reserved.

!function(a){"use strict";var b;try{b=a.chrome.app.getDetails()||{}}catch(c){a.console&&a.console.error("Couldn't get app details"),b={}}b.analyticsId="UA-22980224-1";var d=chrome.storage.local;d.get("installed",function(a){if(!a.installed&&localStorage.getItem("installed")){var b={installed:localStorage.getItem("installed")||!1,exposedSettings:localStorage.getItem("exposedSettings")||!1,enableShortcut:localStorage.getItem("enableShortcut")||90,forceZoomKey:localStorage.getItem("forceZoomKey")||-1,forceHideKey:localStorage.getItem("forceHideKey")||-1,delay:localStorage.getItem("delay")||50,fadeInDuration:localStorage.getItem("fadeInDuration")||150,fadeOutDuration:localStorage.getItem("fadeOutDuration")||150};localStorage.clear(),d.set(b)}});var e,f,g,h,i,j={},k={};k={openCurrentImageInTab:function(a,b){i&&chrome.tabs.create({url:i,selected:!0,index:b.index+1},function(){})},downloadCurrentImage:function(a,b){i&&chrome.tabs.update(b.id,{url:i+(-1===i.indexOf("?")?"?":"&")+"dl=1"},function(){})},openOptions:function(a,b){a=a||{},chrome.tabs.create({url:chrome.extension.getURL("html/options.html")+(a.hash?"#"+a.hash:""),selected:!0,index:b&&b.index+1||9999},function(){})},toggleEnabled:function(){d.get("enabled",function(a){d.set({enabled:!a.enabled}),chrome.contextMenus.update(j.toggleEnable,{checked:!a.enabled}),updateTabs()})}},e=function(a,b){var c={type:"normal",title:"",documentUrlPatterns:["http://*.facebook.com/*","http://facebook.com/*","https://*.facebook.com/*","https://facebook.com/*"]};b=b||{},c.type=b.type||c.type,c.title=b.title||c.title,c.contexts=b.contexts||["all"],c.enabled=b.enabled===!1?!1:!0,("checkbox"==c.type||"radio"==c.type)&&(c.checked="boolean"==typeof b.checked?b.checked:!1),c.onclick=k[a],j[a]?chrome.contextMenus.update(j[a],c,function(){}):j[a]=chrome.contextMenus.create(c,function(){})},f=function(a){j[a]&&(chrome.contextMenus.remove(j[a]),delete j[a])},g=function(){chrome.contextMenus.removeAll(),j={}},h=function(a,b){j[a]||e(a,b),chrome.contextMenus.update(j[a],b,function(){})},d.get(["hideContextMenu","enabled"],function(a){a.hideContextMenu?g():(e("toggleEnabled",{type:"checkbox",title:"Enabled",checked:void 0===a.enabled?!0:!!a.enabled}),e("openOptions",{title:"Open Options Page"}),e("openCurrentImageInTab",{title:"Open Zoomed Image in new Tab",enabled:!1}))}),chrome.extension.onRequest.addListener(function(a,c,e){var f;f=a.name,"setCurrentImageUrl"===f&&(i=a.value||null,d.get(["hideContextMenu"],function(a){a.hideContextMenu||h("openCurrentImageInTab",{enabled:!!i})}),d.get(["lastactive"],function(a){var c=new Date(a.lastactive||0);c.getTime()+36e5<=+new Date&&(l.push(["_trackPageview"]),l.push(["_trackEvent","Awaken",b.version])),d.set({lastactive:+new Date})})),"getExtDetails"===f&&e(b)});var l=l||[];if(l.push(["_setAccount",b.analyticsId]),l.push(["_trackPageview"]),l.push(["_trackEvent","Open",b.version]),d.set({lastactive:+new Date}),function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="https://ssl.google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}(),b){var m,n;m=b.version,n="release"+m,d.get(["installed",n],function(a){if(!a[n]){a.installed||localStorage.getItem("installed")||k.openOptions();var b={installed:!0};b[n]=!0,d.set(b),l.push(["_trackEvent",a.installed?"Upgrade":"Install",m])}})}}(this);